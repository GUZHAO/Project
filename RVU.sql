/*
DARTEDM.F_PROV_EFFORT_RVU
DARTEDM.F_MTHLY_PROV_SERVICE_RVU
Are these all the tables for RVU in DART?
*/
SELECT *
FROM DARTEDM.F_PROV_EFFORT_RVU
WHERE ROWNUM<1000;

SELECT distinct substr(BEG_MTH_DIM_SEQ,1,4) AS y
FROM DARTEDM.F_MTHLY_PROV_SERVICE_RVU
ORDER BY y;

SELECT	a16.MONTH_NBR  MTH_NBR,
	UPPER(SUBSTR(a16.MTH_NM, 1, 3))  CustCol_11,
	a12.EPIC_PROV_ID  PROV_ID,
	(CASE WHEN a15.PROC_CD= '372288'THEN '99203' WHEN a15.PROC_CD= '372292' THEN '99204' WHEN a15.PROC_CD= '372298' THEN '99205' WHEN a15.PROC_CD= '372304' THEN '99211' WHEN a15.PROC_CD= '372322' THEN '99213' WHEN a15.PROC_CD= '372332' THEN '99214' WHEN a15.PROC_CD= '372350' THEN '99215' ELSE a15.CPT_CD END)  CPT_CD,
	a17.CPT_CD_DESCR  CPT_DESCR,
	a15.PROC_NM  SERVICE_DESCR,
	a16.ACADEMIC_PERIOD  ACADEMIC_PERIOD,
	a16.CALENDAR_YR  CALENDAR_YR,
	(CASE WHEN TRIM(a14.MO_DIVISION_NM) IS NULL THEN 'N/A' ELSE TRIM(a14.MO_DIVISION_NM) END)  MO_DIVISION_NM,
	(CASE WHEN TRIM(a14.DISEASE_GRP_ABBREV) IS NULL THEN 'N/A' ELSE TRIM(a14.DISEASE_GRP_ABBREV) END)  CLIN_DEPT_GRP1,
	(CASE WHEN TRIM(a14.SITE_NM) IS NULL THEN 'N/A' ELSE TRIM(a14.SITE_NM) END)  SITE_NM,
	a12.DISEASE_GRP_DESCR  DISEASE_GRP_FN_DEPT_DESCR,
	a12.EPIC_PROV_ID  PROV_ID0,
	a12.PROV_NM  PROV_NM,
	sum(NVL(a11.TOT_WORK_RVU_AMT, 0))  MONTHLYRVU,
	sum(a11.TOT_SERVICE_QTY)  MTDQUANTITY
from	(SELECT RVU.PROV_DIM_SEQ, RVU.PROC_DIM_SEQ, BEG_MTH_DIM_SEQ, INST_DIM_SEQ, CLIN_DEPT_DIM_SEQ, INPAT_OUTPAT_IND,(CASE WHEN PROV.PROV_TYPE_DESCR = 'PHYSICIAN' THEN -1 ELSE SUPER_PROV_DIM_SEQ END) SUPER_PROV_DIM_SEQ, TOT_SERVICE_QTY,TOT_WORK_RVU_AMT,TOT_SERVICE_AMT, RVU.DART_CREATE_DTTM
FROM DARTEDM.F_MTHLY_PROV_SERVICE_RVU RVU
JOIN DARTEDM.D_PROV PROV
ON RVU.PROV_DIM_SEQ = PROV.PROV_DIM_SEQ)	a11
	left outer join	DARTEDM.D_PROV	a12
	  on 	(a11.PROV_DIM_SEQ = a12.PROV_DIM_SEQ)
	left outer join	DARTEDM.D_CLIN_DEPT	a13
	  on 	(a11.CLIN_DEPT_DIM_SEQ = a13.CLIN_DEPT_DIM_SEQ)
	left outer join	DARTEDM.MV_RVU_REPORT_CATEGORY	a14
	  on 	((CASE WHEN a13.CLIN_DEPT_ABBREV IS NULL THEN 'N/A' ELSE a13.CLIN_DEPT_ABBREV END) = (CASE WHEN a14.CLIN_DEPT_ABBREV IS NULL THEN 'N/A' ELSE a14.CLIN_DEPT_ABBREV END) and 
	a12.EPIC_PROV_ID = a14.EPIC_PROV_ID)
	left outer join	DARTEDM.D_PROC	a15
	  on 	(a11.PROC_DIM_SEQ = a15.PROC_DIM_SEQ)
	left outer join	DARTEDM.D_CALENDAR	a16
	  on 	(a11.BEG_MTH_DIM_SEQ = a16.CALENDAR_DIM_SEQ)
	left outer join	DARTEDM.D_CPT_CD	a17
	  on 	((CASE WHEN a15.PROC_CD= '372288'THEN '99203' WHEN a15.PROC_CD= '372292' THEN '99204' WHEN a15.PROC_CD= '372298' THEN '99205' WHEN a15.PROC_CD= '372304' THEN '99211' WHEN a15.PROC_CD= '372322' THEN '99213' WHEN a15.PROC_CD= '372332' THEN '99214' WHEN a15.PROC_CD= '372350' THEN '99215' ELSE a15.CPT_CD END) = (CASE WHEN a17.CPT_CD IS NULL THEN 'N/A' ELSE a17.CPT_CD END))
where	((CASE WHEN TRIM(a14.MO_DIVISION_NM) IS NULL THEN 'N/A' ELSE TRIM(a14.MO_DIVISION_NM) END) not in ('N/A')
 and a12.INT_EXT_IND in ('E')
 and (CASE WHEN TRIM(a14.DISEASE_GRP_ABBREV) IS NULL THEN 'N/A' ELSE TRIM(a14.DISEASE_GRP_ABBREV) END) not in ('STIPEND')
 and a16.CALENDAR_DT between (select min(CALENDAR_DT) from DARTEDM.D_CALENDAR where ACADEMIC_YR = (select ACADEMIC_YR from DARTEDM.D_CALENDAR where CALENDAR_DT = To_Date('31-07-2017', 'dd-mm-yyyy'))) and To_Date('31-07-2017', 'dd-mm-yyyy'))
group by	a16.MONTH_NBR,
	upper(SUBSTR(a16.MTH_NM, 1, 3)),
	a12.EPIC_PROV_ID,
	(CASE WHEN a15.PROC_CD= '372288'THEN '99203' WHEN a15.PROC_CD= '372292' THEN '99204' WHEN a15.PROC_CD= '372298' THEN '99205' WHEN a15.PROC_CD= '372304' THEN '99211' WHEN a15.PROC_CD= '372322' THEN '99213' WHEN a15.PROC_CD= '372332' THEN '99214' WHEN a15.PROC_CD= '372350' THEN '99215' ELSE a15.CPT_CD END),
	a17.CPT_CD_DESCR,
	a15.PROC_NM,
	a16.ACADEMIC_PERIOD,
	a16.CALENDAR_YR,
	(CASE WHEN TRIM(a14.MO_DIVISION_NM) IS NULL THEN 'N/A' ELSE TRIM(a14.MO_DIVISION_NM) END),
	(CASE WHEN TRIM(a14.DISEASE_GRP_ABBREV) IS NULL THEN 'N/A' ELSE TRIM(a14.DISEASE_GRP_ABBREV) END),
	(CASE WHEN TRIM(a14.SITE_NM) IS NULL THEN 'N/A' ELSE TRIM(a14.SITE_NM) END),
	a12.DISEASE_GRP_DESCR,
	a12.EPIC_PROV_ID,
	a12.PROV_NM
